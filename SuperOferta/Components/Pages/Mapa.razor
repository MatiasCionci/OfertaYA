@page "/Mapas/{ubicacionx}/{ubicaciony}"
@inject IJSRuntime JS
@rendermode InteractiveServer

@using Microsoft.AspNetCore.Components

   
   

<button class="btn btn-outline-success" data-toggle="tooltip" title="Exportar" @onclick="Export">Ver Ubicacion </button>
<div class="qr-code-container">
    <div class="qr-code" style></div>
</div>
<div id="map" class="map" style="height:500px;width:100%" margin-top: 20px;></div>

    <script>
        window.GenerarMapa = async (ubicacionx,ubicaciony) => {
      
       


        var map = L.map('map').setView([ubicacionx,ubicaciony], 13);


            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

       
       
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var userLat = position.coords.latitude;
                var userLng = position.coords.longitude;

                // Agregar un marcador para la ubicación actual del usuario
                L.marker([userLat, userLng]).addTo(map)
                    .bindPopup('Estás aquí')
                    .openPopup();

                L.marker([ubicacionx, ubicaciony]).addTo(map)
                    .bindPopup('SupermercadoUbicacion')
                    .openPopup();


                // Centrar el mapa en la ubicación del usuario
             
            }
    );
    } 
        }
        
    </script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

@code {
    [Parameter]
    public string Ubicacionx { get; set; } 
    [Parameter]
    public string Ubicaciony { get; set; }
    public string Titulo = "titu";
    public async Task  Export()
    {
        Titulo = Titulo + "pasomapa";
        try
        {
            await JS.InvokeVoidAsync("GenerarMapa",Ubicacionx,Ubicaciony);
            Titulo = Titulo + "pasomapa";
           
        }
        catch
        {
            Titulo = "nopaso";
        }

     

    }
 
}


